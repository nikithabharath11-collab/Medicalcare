{% extends "base.html" %}
{% block title %}AI Health Chat - MedicalCare AI{% endblock %}

{% block content %}
<div class="chat-container">
    <div class="page-header">
        <h1 style="color: var(--gold); font-size: 2rem;">AI Health Assistant</h1>
        <p style="color: var(--text-secondary);">Chat with MedCare AI for instant health guidance and medical information</p>
    </div>

    <div class="chat-box" id="chatBox">
        <div class="chat-message bot">
            <div class="chat-avatar">AI</div>
            <div class="chat-bubble">
                Hello! I'm MedCare AI, your health assistant. How can I help you today? You can ask me about symptoms, health tips, nutrition, exercise, or any medical concerns.
            </div>
        </div>
    </div>

    <div class="chat-input-area">
        <input type="text" id="chatInput" placeholder="Ask a health question..." autocomplete="off"
               onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">Send</button>
    </div>

    <div style="margin-top: 1.5rem;">
        <p style="color: var(--text-muted); font-size: 0.8rem; text-align: center;">Quick topics you can ask about:</p>
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; margin-top: 0.75rem;">
            <button class="btn btn-sm btn-gold-outline" onclick="askQuick('What are symptoms of diabetes?')">Diabetes</button>
            <button class="btn btn-sm btn-gold-outline" onclick="askQuick('How to maintain heart health?')">Heart Health</button>
            <button class="btn btn-sm btn-gold-outline" onclick="askQuick('Tips for better sleep')">Sleep Tips</button>
            <button class="btn btn-sm btn-gold-outline" onclick="askQuick('Best diet for weight loss')">Diet Tips</button>
            <button class="btn btn-sm btn-gold-outline" onclick="askQuick('How to manage stress and anxiety?')">Mental Health</button>
            <button class="btn btn-sm btn-gold-outline" onclick="askQuick('Exercise recommendations for beginners')">Exercise</button>
        </div>
    </div>

    <p style="color: var(--text-muted); font-size: 0.75rem; text-align: center; margin-top: 1rem;">
        Disclaimer: MedCare AI provides general health information only. Always consult a qualified healthcare professional for medical advice.
    </p>
</div>
{% endblock %}

{% block extra_js %}
<script>
const chatBox = document.getElementById('chatBox');
const chatInput = document.getElementById('chatInput');

function addMessage(text, type) {
    const div = document.createElement('div');
    div.className = 'chat-message ' + type;
    div.innerHTML = `
        <div class="chat-avatar">${type === 'user' ? 'You' : 'AI'}</div>
        <div class="chat-bubble">${text}</div>
    `;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function askQuick(question) {
    chatInput.value = question;
    sendMessage();
}

async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;

    addMessage(message, 'user');
    chatInput.value = '';

    const typing = document.createElement('div');
    typing.className = 'chat-message bot';
    typing.id = 'typingIndicator';
    typing.innerHTML = '<div class="chat-avatar">AI</div><div class="chat-bubble" style="color: var(--text-muted);">Thinking...</div>';
    chatBox.appendChild(typing);
    chatBox.scrollTop = chatBox.scrollHeight;

    try {
        const res = await fetch('/api/chat', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ message: message })
        });
        const json = await res.json();

        const indicator = document.getElementById('typingIndicator');
        if (indicator) indicator.remove();

        if (json.status === 'success') {
            addMessage(json.reply, 'bot');
        } else {
            addMessage('Sorry, I encountered an error. Please try again.', 'bot');
        }
    } catch(err) {
        const indicator = document.getElementById('typingIndicator');
        if (indicator) indicator.remove();
        addMessage('Unable to connect to the server. Please make sure the server is running.', 'bot');
    }
}
</script>
{% endblock %}
