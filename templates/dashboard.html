{% extends "base.html" %}
{% block title %}Dashboard - MedicalCare AI{% endblock %}

{% block content %}
<div class="container" style="padding-top: 2rem;">
    <div class="section-title">
        <h2>Analytics <span class="gold">Dashboard</span></h2>
        <div class="section-divider"></div>
        <p>Model performance metrics and system overview</p>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, var(--gold), var(--gold-dark));">&#9829;</div>
            <div class="stat-info">
                <h4>5</h4>
                <p>AI Models</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #00c853, #00a844);">&#9878;</div>
            <div class="stat-info">
                <h4>3</h4>
                <p>ML Algorithms</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #2196f3, #1976d2);">&#9881;</div>
            <div class="stat-info">
                <h4>2</h4>
                <p>Deep Learning Models</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #ff1744, #d50000);">&#9762;</div>
            <div class="stat-info">
                <h4>10</h4>
                <p>Diseases Covered</p>
            </div>
        </div>
    </div>

    <!-- Model Details -->
    <div class="section-title" style="margin-top: 2rem;">
        <h2>Model <span class="gold">Information</span></h2>
        <div class="section-divider"></div>
    </div>

    <div id="modelCards" class="cards-grid">
        <div style="text-align:center; padding: 2rem;">
            <div class="spinner show"></div>
            <p style="color: var(--text-muted);">Loading model information...</p>
        </div>
    </div>

    <!-- Architecture Overview -->
    <div class="form-card" style="margin-top: 2rem;">
        <h3 style="margin-bottom: 1.5rem; color: var(--gold);">System Architecture</h3>
        <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
            <div>
                <h4 style="color: #64b5f6; margin-bottom: 0.5rem;">Machine Learning Pipeline</h4>
                <ul style="color: var(--text-secondary); padding-left: 1.5rem; line-height: 2;">
                    <li>Data Collection &amp; Synthetic Generation</li>
                    <li>Feature Engineering &amp; Selection</li>
                    <li>Model Training (RF, GBM, SVM)</li>
                    <li>Cross-Validation &amp; Hyperparameter Tuning</li>
                    <li>Model Serialization with Joblib</li>
                    <li>REST API Deployment with Flask</li>
                </ul>
            </div>
            <div>
                <h4 style="color: #ef9a9a; margin-bottom: 0.5rem;">Deep Learning Pipeline</h4>
                <ul style="color: var(--text-secondary); padding-left: 1.5rem; line-height: 2;">
                    <li>Neural Network (Dense layers + BatchNorm)</li>
                    <li>CNN with MobileNetV2 Transfer Learning</li>
                    <li>Image Preprocessing (224x224 RGB)</li>
                    <li>Binary &amp; Multi-class Classification</li>
                    <li>Dropout Regularization</li>
                    <li>Adam Optimizer with Learning Rate Scheduling</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Algorithms Used -->
    <div class="form-card" style="margin-top: 2rem;">
        <h3 style="margin-bottom: 1.5rem; color: var(--gold);">Algorithms &amp; Techniques</h3>
        <div class="cards-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
            <div style="padding: 1rem; background: rgba(10, 22, 40, 0.6); border: 1px solid rgba(255,255,255,0.05); border-radius: 8px;">
                <h4 style="color: #64b5f6;">Random Forest</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">Ensemble of decision trees for robust classification. Used for diabetes and disease prediction.</p>
            </div>
            <div style="padding: 1rem; background: rgba(10, 22, 40, 0.6); border: 1px solid rgba(255,255,255,0.05); border-radius: 8px;">
                <h4 style="color: #69f0ae;">Gradient Boosting</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">Sequential ensemble method for heart disease prediction with high accuracy.</p>
            </div>
            <div style="padding: 1rem; background: rgba(10, 22, 40, 0.6); border: 1px solid rgba(255,255,255,0.05); border-radius: 8px;">
                <h4 style="color: #ef9a9a;">Deep Neural Network</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">Multi-layer perceptron with BatchNorm and Dropout for breast cancer detection.</p>
            </div>
            <div style="padding: 1rem; background: rgba(10, 22, 40, 0.6); border: 1px solid rgba(255,255,255,0.05); border-radius: 8px;">
                <h4 style="color: var(--gold);">CNN + Transfer Learning</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">MobileNetV2 backbone for medical image classification with fine-tuning.</p>
            </div>
        </div>
    </div>

    <!-- Health News Section -->
    <div class="section-title" style="margin-top: 3rem;">
        <h2>Health <span class="gold">News &amp; Tips</span></h2>
        <div class="section-divider"></div>
    </div>

    <div id="newsGrid" class="news-grid">
        <div style="text-align:center; padding: 2rem;">
            <div class="spinner show"></div>
            <p style="color: var(--text-muted);">Loading health news...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function loadModelInfo() {
    try {
        const res = await fetch('/api/model-info');
        const json = await res.json();
        const container = document.getElementById('modelCards');

        const gradients = ['gradient-1', 'gradient-2', 'gradient-3', 'gradient-4', 'gradient-5'];
        const icons = ['&#9829;', '&#9883;', '&#9762;', '&#9878;', '&#9881;'];

        let html = '';
        json.models.forEach((m, i) => {
            html += `
                <div class="card">
                    <div class="card-header ${gradients[i]}">
                        <h3>${m.name}</h3>
                        <div class="card-icon">${icons[i]}</div>
                    </div>
                    <div class="card-body">
                        <p><strong>Algorithm:</strong> ${m.type}</p>
                        <p><strong>Category:</strong> ${m.category}</p>
                        <p><strong>Input Features:</strong> ${m.features}</p>
                        <p><strong>Status:</strong>
                            <span style="color: ${m.trained ? '#69f0ae' : '#ff5252'}; font-weight: 700;">
                                ${m.trained ? 'Trained & Ready' : 'Not Trained - Run train.py'}
                            </span>
                        </p>
                        <span class="card-tag ${m.category === 'Deep Learning' ? 'tag-dl' : 'tag-ml'}">${m.category}</span>
                    </div>
                </div>
            `;
        });
        container.innerHTML = html;
    } catch(err) {
        document.getElementById('modelCards').innerHTML =
            '<p style="text-align:center; color:#ff5252;">Could not load model info. Is the server running?</p>';
    }
}

async function loadHealthNews() {
    try {
        const res = await fetch('/api/health-news');
        const json = await res.json();
        const container = document.getElementById('newsGrid');

        if (json.status === 'success') {
            let html = '';
            json.news.forEach(item => {
                html += `
                    <div class="news-card">
                        <h4>${item.title}</h4>
                        <p>${item.summary}</p>
                        <div class="news-meta">${item.category} &bull; ${item.date}</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }
    } catch(err) {
        document.getElementById('newsGrid').innerHTML =
            '<p style="text-align:center; color:var(--text-muted);">Could not load health news.</p>';
    }
}

loadModelInfo();
loadHealthNews();
</script>
{% endblock %}
